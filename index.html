<script>
  let extractedValues = [];

  document.getElementById("file-upload").addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    document.getElementById("upload-status").textContent = "업로드 완료";

    const reader = new FileReader();
    reader.onload = async () => {
      const imageData = reader.result;

      // 최신 Tesseract.js 방식은 createWorker 없이 바로 recognize 사용
      const { data: { text } } = await Tesseract.recognize(imageData, 'eng');
      console.log("OCR 텍스트:", text);

      const numbers = text.match(/[\d']+\:\d+|[\d.]+|[\d']+\”/g); // 시간, 소수, 숫자 등
      console.log("추출된 숫자 목록:", numbers);

      if (numbers && numbers.length >= 7) {
        let kmValue = numbers.find(n => n.includes('.') && parseFloat(n) > 1 && parseFloat(n) < 100) || "0.00";
        document.getElementById("km").textContent = kmValue;

        const filtered = numbers.filter(n => n !== kmValue).slice(0, 6);
        extractedValues = filtered;
        console.log("하단 통계 값:", extractedValues);
      } else {
        document.getElementById("upload-status").textContent = "인식 실패. 이미지의 선명도를 확인해주세요.";
      }
    };
    reader.readAsDataURL(file);
  });

  function runAnimation() {
    const keys = ["pace", "time", "calories", "elevation", "heartrate", "cadence"];
    keys.forEach((key, i) => {
      document.getElementById(key).textContent = extractedValues[i] || "-";
    });
  }
</script>
